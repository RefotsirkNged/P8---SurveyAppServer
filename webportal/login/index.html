<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="../CookieHelper.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div class="wrapper">
    <label>Email</label> <input id="loginemail" type="text" value="researcher1@email.com"/>
    <label>Password</label><input id="loginpassword" type="password" value="pypass"/>
    <br>
    <br>
    <button id="loginbutton" onclick="login()">Login</button>
</div>

<div id="loginfailedmodal" class="modal">
    <div class="modal-content">
        <span id="modalclose">&times;</span>
        <p id="loginfailedmessage"></p>
    </div>
</div>

</body>
</html>
<script>
    var modal = document.getElementById("loginfailedmodal");
    var span = document.getElementById("modalclose");

    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };

    span.onclick = function () {
        modal.style.display = "none";
    };

    function login() {
        var email = document.getElementById('loginemail').value;
        var password = document.getElementById('loginpassword').value;

        $.ajax({
            url: 'http://localhost:8080/api/researcher/login',
            type: 'POST',
            beforeSend: function (request) {
                request.setRequestHeader("email", email);
                request.setRequestHeader("password", password);
            },
            //data: {email: email, password: password},
            success: function (response) {
                if(response.hasOwnProperty("error")){
                    modal.style.display = "block";
                    document.getElementById("loginfailedmessage").innerText = response.error;
                }
                else {
                    sessionStorage.setItem('token', response.token);
                    setCookie("token", response.token, 1);
                    window.location.replace("../index.html");
                }
            },
            error: function (response) {
                modal.style.display = "block";

                document.getElementById("loginfailedmessage").innerText = "Something happened";
            }
        });

    }
</script>